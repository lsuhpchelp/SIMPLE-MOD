#%Module

# =====================================================================
# Generated by SIMPLE-MOD
# Developer: Jason Li (jasonli3@lsu.edu)
# Description: 
#       1) This module template is compatible with:
#            - Environment Modules >= 4.5.2. 
#               See https://github.com/cea-hpc/modules
#            - Lmod >= 8.7.34. 
#               See https://github.com/TACC/Lmod
#          May not be compatible with different module systems.
#       2) This template generates wrapper scripts in users' 
#          environment, and works with MPI-enabled software packages.
# =====================================================================

# ---------------------------------------------------------------------
# Wrapper scripts path (Customize me)
# ---------------------------------------------------------------------

set WRAPPER_PATH /work/$env(USER)/.modulebin

# ---------------------------------------------------------------------
# Software specific information
# ---------------------------------------------------------------------

# Module information
module-whatis Name: augustus
module-whatis Version: 3.5.0
module-whatis Description: AUGUSTUS is a program to find genes and their structures in one or more genomes.

# Singularity options
set SINGULARITY_IMAGE "/home/admin/singularity/busco-5.7.1.sif"
set SINGULARITY_BINDPATHS "/work,/project,/usr/local/packages,/ddnA,/var/scratch,"
set SINGULARITY_FLAGS " "

# Conflicts
conflict augustus 

# List of commands to overwrite
set CMDS {
aln2wig augustus bam2hints bam2wig compileSpliceCands etraining fastBlockSearch filterBam getSeq homGeneMapping joingenes prepareAlign utrrnaseq
augustify.py bamToWig.py cleanup-blastdb-volumes.py edirect.py executeTestCGP.py extractAnno.py findRepetitiveProtSeqs.py fix_in_frame_stop_codon_genes.py generate_plot.py getAnnoFastaFromJoingenes.py run_sepp.py run_upp.py split_sequences.py stringtie2fa.py sumlabels.py sumtrees.py windowmasker_2.2.22_adapter.py
aa2nonred.pl add_name_to_gff3.pl augustus2browser.pl augustus2gbrowse.pl autoAug.pl autoAugPred.pl autoAugTrain.pl bedgraph2wig.pl blast2sam.pl blat2gbrowse.pl blat2hints.pl block2prfl.pl bowtie2sam.pl cegma2gff.pl checkParamArchive.pl cleanDOSfasta.pl clusterAndSplitGenes.pl compare_masking.pl computeFlankingRegion.pl createAugustusJoblist.pl del_from_prfl.pl evalCGP.pl eval_dualdecomp.pl eval_multi_gtf.pl exonerate2hints.pl exoniphyDb2hints.pl export2sam.pl extractTranscriptEnds.pl fasta-sanitize.pl filter-ppx.pl filterGenes.pl filterGenesIn.pl filterGenesIn_mRNAname.pl filterGenesOut_mRNAname.pl filterInFrameStopCodons.pl filterMaf.pl filterPSL.pl filterShrimp.pl filterSpliceHints.pl findGffNamesInFasta.pl fix_joingenes_gtf.pl gbSmallDNA2gff.pl gbrowseold2gff3.pl getAnnoFasta.pl getLinesMatching.pl get_loci_from_gb.pl gff2gbSmallDNA.pl gffGetmRNA.pl gp2othergp.pl gtf2aa.pl gtf2bed.pl gtf2gff.pl gth2gtf.pl hal2maf_split.pl interpolate_sam.pl joinPeptides.pl join_aug_pred.pl join_mult_hints.pl legacy_blast.pl maf2conswig.pl makeMatchLists.pl makeUtrTrainingSet.pl maskNregions.pl merge_masking.pl moveParameters.pl msa2prfl.pl new_species.pl novo2sam.pl opt_init_and_term_probs.pl optimize_augustus.pl parseSim4Output.pl partition_gtf2gb.pl pasapolyA2hints.pl peptides2alternatives.pl peptides2hints.pl phastconsDB2hints.pl polyA2hints.pl prints2prfl.pl psl2sam.pl pslMap.pl randomSplit.pl rename_species.pl retroDB2hints.pl rmRedundantHints.pl runAllSim4.pl sam2vcf.pl samMap.pl samtools.pl scipiogff2gff.pl seq_cache_populate.pl setStopCodonFreqs.pl simpleFastaHeaders.pl simplifyFastaHeaders.pl soap2sam.pl splitMfasta.pl split_wiggle.pl summarizeACGTcontent.pl transMap2hints.pl uniquePeptides.pl update_blastdb.pl utrgff2gbrowse.pl weedMaf.pl wgsim_eval.pl wig2hints.pl wigchoose.pl writeResultsPage.pl yaml2gff.1.4.pl zoom2sam.pl
}

# Set environment varialbles


# ---------------------------------------------------------------------
# Module key setup
# ---------------------------------------------------------------------

# Combine Singularity exec command
set SINGULARITY_EXEC "singularity exec -B $SINGULARITY_BINDPATHS $SINGULARITY_FLAGS --pwd \$PWD $SINGULARITY_IMAGE"

# Set wrapper directory
file mkdir $WRAPPER_PATH/augustus/3.5.0
prepend-path PATH $WRAPPER_PATH/augustus/3.5.0

# Create wrappers when the module is loaded
if { [ module-info mode load ] } {

    # If it is csh type shell
    if { [module-info shelltype] == "csh" } {
    
        # Create wrappers for each command
        foreach cmd $CMDS {
            puts "echo '#\\!/bin/bash' > $WRAPPER_PATH/augustus/3.5.0/$cmd;"
            puts "echo '$SINGULARITY_EXEC $cmd $@' >> $WRAPPER_PATH/augustus/3.5.0/$cmd;"
            puts "chmod u+x $WRAPPER_PATH/augustus/3.5.0/$cmd;"
        }
        
        # Refresh cache (only for csh type shell)
        puts "rehash;"
        
    # If it is sh type shell
    } elseif { [module-info shelltype] == "sh" } {
    
        # Create wrappers for each command
        foreach cmd $CMDS {
            puts "echo '#!/bin/bash' > $WRAPPER_PATH/augustus/3.5.0/$cmd;"
            puts "echo '$SINGULARITY_EXEC $cmd $@' >> $WRAPPER_PATH/augustus/3.5.0/$cmd;"
            puts "chmod u+x $WRAPPER_PATH/augustus/3.5.0/$cmd;"
        }
        
    }
}

# Currently, wrappers will not be deleted to avoid unwanted issues.

# Help information
proc ModulesHelp {} {
    global CMDS
    puts stderr "

\[ Help information \]

1. This module only works on computing nodes (not available on head nodes). Make sure you start a job!

2. Below executables are available:
$CMDS"
}
if { [ module-info mode load ] } {
    ModulesHelp
}
